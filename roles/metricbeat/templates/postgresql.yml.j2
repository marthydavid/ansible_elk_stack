# {{ ansible_managed }}
- module: postgresql
  metricsets:
    # Stats about every PostgreSQL database
    - database

    # Stats about the background writer process's activity
    - bgwriter

    # Stats about every PostgreSQL process
    - activity

  period: 10s

  # The host must be passed as PostgreSQL URL. Example:
  # postgres://localhost:5432?sslmode=disable
  # The available parameters are documented here:
  # https://godoc.org/github.com/lib/pq#hdr-Connection_String_Parameters
  {% if beats_pgsql_module_hosts  %}
  {% else %}
    {% set beats_pgsql_module_hosts = 'postgres://localhost:5432' %}
  {% endif %}
  hosts: ["{{ beats_pgsql_module_hosts }}"]
  # Username to use when connecting to PostgreSQL. Empty by default.
  {% if beats_pgsql_module_user %}
    {% set beats_pgsql_module_user_line = {% raw %}username: {{ beats_pgsql_module_user }}{% endraw %} %}
  {% else  %}
    {% set beats_pgsql_module_user_line = "#username: user" %}
  {% endif %}
  {{ beats_pgsql_module_user_line }}

  # Password to use when connecting to PostgreSQL. Empty by default.
  {% if beats_pgsql_module_pass %}
    {% set beats_pgsql_module_pass_line = {% raw %}password: {{ beats_pgsql_module_pass }}{% endraw %} %}
  {% else  %}
    {% set beats_pgsql_module_pass_line = "#password: pass" %}
  {% endif %}
  {{ beats_pgsql_module_pass_line }}